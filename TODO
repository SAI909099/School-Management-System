# Maqsad

O‘quv markazi/maktab uchun to‘liq boshqaruv tizimi: telefon raqam + parol orqali kirish, rollarga asoslangan ruxsatlar, dars jadvali, baholash (2–5), imtihonlar (oraliq va yakuniy), GPA hisoblash, kunlik davomat, ta’til/kalendaryozuvlar, o‘qituvchilar bo‘sh vaqti, ma’mur jadval (timetable), to‘lovlar (oylik, qarzdorlar ro‘yxati), reyting (Top 100 / Past 100).

---

## Rollar va ruxsatlar

**Admin (Administrator)**

* Foydalanuvchilarni yaratish/tahrirlash (rol belgilash)
* Fanlar, sinflar, o‘qituvchilar, o‘quvchilarni boshqarish
* Bayram/Ta’til kunlarini kiritish (kalendarga)
* O‘qituvchilarning bo‘sh vaqtini ko‘rish
* Timetable (dars jadvali) yaratish/tahrirlash **(faqat Admin)**
* To‘lovlar modulining sozlamalari (oylik miqdori, chegirmalar)
* Reyting sahifasi (Top/Past 100)

**Teacher (O‘qituvchi)**

* O‘z sinflari/guruhlarining jadvalini ko‘rish
* Davomatni belgilash (har kuni)
* Baholarni kiritish (2–5): kundalik, oraliq imtihon, yakuniy imtihon
* O‘z bo‘sh vaqt oynalarini kiritish (Admin ko‘radi)

**Accountant (Hisobchi/Kassir)**

* O‘quvchi uchun hisob-faktura (oylik) chiqarish
* To‘lov qabul qilish (naqd/karta/transfer)
* Qarzdorlar ro‘yxati, to‘lov tarixini ko‘rish/chiqarish

**Registrar (Ro‘yxatga oluvchi)**

* Yangi o‘quvchilarni ro‘yxatga olish
* O‘quvchini sinfga biriktirish, shaxsiy ma’lumotlarni yangilash

---

## Entitetlar (Model dizayni)

**User** (custom): `phone (unique)`, `password`, `role = [admin|teacher|accountant|registrar]`, `first_name`, `last_name`, `is_active`

**Teacher**: `user(FK)`, `specialty(FK Subject)`, `is_class_teacher (bool)`, `notes`

**Subject (Fan)**: `name`, `code`

**Class (Sinf)**: `name` (masalan, "7-A"), `class_teacher(FK Teacher)`

**Student (O‘quvchi)**: `first_name`, `last_name`, `dob`, `gender`, `class(FK)`, `parent_phone`, `status=[active|graduated|left]`

**ScheduleEntry (Timetable)**: `class(FK)`, `subject(FK)`, `teacher(FK)`, `weekday (1-7)`, `start_time`, `end_time`, `room`

**Attendance (Davomat)**: `student(FK)`, `date`, `status=[present|absent|late|excused]`, `class(FK)`, `teacher(FK)`, `note`

**Grade (Baho)**: `student(FK)`, `subject(FK)`, `teacher(FK)`, `date`, `type=[daily|exam|final]`, `score (int 2..5)`, `weight (decimal, optional)`, `comment`

**Exam (Imtihon)** (ixtiyoriy, agar markaz bo‘yicha reestr kerak bo‘lsa): `name`, `term`, `subject(FK)`, `date`, `max_score=5`

**GradeScale (Sozlama)**: 2–5 ni GPA balliga mapping (masalan: 2→0.0, 3→2.5, 4→3.5, 5→5.0). Maktab bo‘yicha sozlanadigan jadval.

**GPAConfig (Sozlama)**: `weight_daily`, `weight_exam`, `weight_final` (masalan 0.5/0.3/0.2, sinf yoki yil darajasida sozlanadi)

**CalendarEvent**: `title`, `date` yoki `start/end`, `type=[holiday|teacher_free|school_event]`, `teacher(FK, null for holiday)`, `all_day(bool)`

**TuitionPlan (Oylik to‘lov rejasi)**: `class(FK)` yoki `level`, `amount_uzs`

**Invoice (Oy bo‘yicha hisob)**: `student(FK)`, `month (YYYY-MM)`, `amount_uzs`, `status=[unpaid|partial|paid]`, `due_date`, `notes`

**Payment**: `student(FK)`, `invoice(FK)`, `amount_uzs`, `method=[cash|card|transfer]`, `paid_at`, `receipt_no`

---

## GPA hisoblash

1. **Konvertatsiya**: har bir `Grade.score (2..5)` → `grade_points` orqali GradeScale bo‘yicha.
2. **Fan bo‘yicha vaznlash**:

   * `daily` baholar o‘rtachasi × `weight_daily`
   * `exam` baholar o‘rtachasi × `weight_exam`
   * `final` (yakuniy) baho × `weight_final`
3. **Fan GPA** = (vaznli yig‘indi). Agar kredit/soat bo‘yicha farqlansa, fan `credit` bilan ko‘paytirib umumiyga qo‘shish.
4. **Umumiy GPA** = barcha fanlar GPA larining o‘rtachasi (yoki kredit bilan vaznlashgan o‘rtacha).

> Eslatma: vaznlar va mappinglar **GPAConfig/GradeScale** orqali o‘zgaruvchan bo‘lsin (Admin paneldan).

**Reyting**:

* `Top 100` → eng yuqori umumiy GPA bo‘yicha 100 talik
* `Past 100` → eng past umumiy GPA bo‘yicha 100 talik
* Filtrlar: sinf, parallel (masalan, 7-sinflar), davr/term

---

## Kalendaryozuvlar & Jadval

* **Admin**: bayram/ta’til (masalan, 8-mart) qo‘shadi → barcha o‘qituvchi/foydalanuvchilarga ko‘rinadi
* **Teacher**: shaxsiy `teacher_free` slotlarini kiritadi (dars qo‘yish planlash uchun)
* **Admin**: o‘qituvchilarning bo‘sh vaqtini ko‘rib, **Timetable** ni tahrirlaydi
* Jadvalni eksport: PDF/Excel (sinf bo‘yicha, o‘qituvchi bo‘yicha)

---

## To‘lovlar

* **Oylik avtomatik hisob**: har oy uchun barcha faol o‘quvchilarga `Invoice` yaratish (class → TuitionPlan.amount\_uzs)
* **Kassir**: `Payment` yozadi, `Invoice.status` yangilanadi
* **Qarzdorlar**: `Invoice.status != paid` bo‘yicha ro‘yxat, filtr: sinf/oy
* **Tarix**: o‘quvchi kesimida barcha to‘lovlar va oylar kesimi
* **Chegirmalar**: Invoice.amount\_uzs ustida qo‘lda tahrir yoki `discount` maydoni
* **Chiqishlar**: Kvitansiya (PDF), Excel eksport

---

## API (DRF) yo‘llari — minimal

**Auth**

* `POST /api/auth/login` (phone, password)
* `POST /api/auth/register` (admin/registrar only)
* `GET /api/auth/me`

**Ma’lumotnomalar**

* `GET /api/subjects/`, `POST/PUT/DELETE` (Admin)
* `GET /api/classes/`, `POST/PUT/DELETE` (Admin)
* `GET /api/teachers/` (Admin), `POST/PUT/DELETE` (Admin)

**O‘quvchi**

* `GET/POST /api/students/` (Registrar/Admin)
* `GET /api/students/{id}/profile` (Teacher for own classes, Admin)
* `GET /api/students/{id}/grades` (Teacher/Admin)
* `GET /api/students/{id}/gpa?term=...` (Teacher/Admin)

**Jadval**

* `GET /api/schedule/class/{class_id}`
* `GET /api/schedule/student/{student_id}`
* `POST/PUT/DELETE /api/schedule/` (Admin)

**Davomat**

* `POST /api/attendance/mark` (Teacher)
* `GET /api/attendance/class/{class_id}?date=YYYY-MM-DD`

**Baholar**

* `POST /api/grades/` (Teacher)
* `GET /api/grades/student/{id}?subject=...&term=...`

**Kalendaryozuvlar**

* `GET /api/calendar/events`
* `POST /api/calendar/holiday` (Admin)
* `POST /api/calendar/teacher-free` (Teacher)

**To‘lov**

* `GET /api/billing/invoices?month=YYYY-MM&class=...&status=...`
* `POST /api/billing/invoices/generate?month=YYYY-MM` (Admin)
* `POST /api/billing/payments` (Accountant)
* `GET /api/billing/students/{id}/balance`
* `GET /api/billing/overdue?month=YYYY-MM`

**Reyting**

* `GET /api/ranking/top?limit=100&term=...`
* `GET /api/ranking/bottom?limit=100&term=...`

---

## Frontend sahifalar (UZ UI)

**Kirish**: Telefon raqami (+998 \*\*\*) + parol

**Admin Panel**

* Boshqaruv: Fanlar, Sinflar, O‘qituvchilar, O‘quvchilar
* Kalendaryozuv: Bayramlar/ta’til
* Dars jadvali konstruktor (drag-drop)
* To‘lovlar: Oyliklar, qarzdorlar, to‘lovlar tarixi
* Reyting: Top 100 / Past 100 (filtrlar)

**O‘qituvchi**

* Mening dars jadvalim
* Sinf(lar)im: Davomat, Baholar (Gradebook)
* Imtihonlar ro‘yxati; Yakuniy baho kiritish
* Bo‘sh vaqtlarim

**Hisobchi**

* Kassa: To‘lov qabul qilish (o‘quvchi qidirish → Invoice → Payment)
* Kvitansiya chop etish
* Qarzdorlar ro‘yxati

**Ro‘yxatga oluvchi**

* O‘quvchini qo‘shish, sinfga biriktirish, ma’lumotlarni tahrirlash

**(Kelajak)** Ota-ona/O‘quvchi kabineti: jadval, baho, davomat, to‘lov holati

---

## Hisobot va eksportlar

* Davomat jadvali (kunlik/sinf bo‘yicha) — PDF/Excel
* Gradebook — PDF/Excel
* Oylik to‘lovlar, qarzdorlar — Excel
* Kvitansiya — PDF (UZS, sana/raqam)

---

## Tavsiyalar (best practices)

* **Telefon bilan autentifikatsiya**: phone unique, format+998, ratelimit; keyinchalik SMS tasdiqlash
* **Lokalizatsiya**: `LANGUAGE_CODE='uz'`, `TIME_ZONE='Asia/Tashkent'`
* **Sozlanadigan GPA**: vaznlar va 2–5 → GPA mappingni modelda saqlang — yil/sinf bo‘yicha
* **Audit**: baho/davomat/to‘lov o‘zgarishlariga audit log (kim, qachon)
* **Ruxsatlar**: DRF permissions + object-level checks (o‘qituvchi faqat o‘z sinflari)
* **Ma’lumot sifati**: "yakuniy" baho faqat term muddati oxirida; baho 2..5 validatsiya
* **Ish unumdorligi**: indekslar — `student_id`, `class_id`, `term`, `month`
* **Zaxiralash**: Postgres backup (daily), media/eksport fayllar
* **Pul birliklari**: UZS, Decimal(12,0); summalarni `int` so‘mda saqlash ham mumkin

---

## Sprint reja (MVP → V1)

**Sprint 0 – Skelet**

* Django + DRF + Postgres; custom User (phone como login); JWT
* Base apps: `accounts`, `core`, `billing`, `schedule`

**Sprint 1 – Ma’lumotnomalar**

* Subjects, Classes, Teachers CRUD; Registrar roli

**Sprint 2 – O‘quvchi**

* Student CRUD, sinfga biriktirish, ro‘yxatlar

**Sprint 3 – Timetable & Kalendar**

* ScheduleEntry CRUD (Admin); CalendarEvent (holiday/teacher\_free)

**Sprint 4 – Davomat & Baho**

* Attendance markasi; Grade CRUD (2–5); GradeScale & GPAConfig sozlamalari

**Sprint 5 – GPA & Reyting**

* GPA endpointlari; Top/Past 100 sahifalari

**Sprint 6 – Billing**

* Invoice generate (oylik); Payment kiritish; Overdue ro‘yxati; kvitansiya

**Sprint 7 – Hisobotlar**

* PDF/Excel eksportlar; audit loglar; optimizatsiya

---

## Ma’lumotlar modeli – qo‘shimcha maydonlar (UZ label)

* Student: `passport_or_id`, `address`, `parent_name`, `parent_phone (asosiy)`, `second_parent_phone (ixtiyoriy)`
* Teacher: `rating (optional)`, `workload_hours`
* Class: `level (1–11 yoki kurs)`, `capacity`
* Subject: `credit (ixtiyoriy)`, `is_core (bool)`
* Grade: `term (masalan 2024-2025-1)`, `attempt_no`
* Invoice: `discount_uzs`, `penalty_uzs (kechikkanlar uchun, ixtiyoriy)`

---

## Namuna: GPA hisoblash (psevdo-kod)

```
scale = {2:0.0, 3:2.5, 4:3.5, 5:5.0}
weights = {daily:0.5, exam:0.3, final:0.2}

grades = all Grades for student & term & subject
G_daily = avg(scale[g.score] for g in grades if g.type=='daily')
G_exam  = avg(scale[g.score] for g in grades if g.type=='exam')
G_final = avg(scale[g.score] for g in grades if g.type=='final')  # odatda 1 ta
subject_gpa = G_daily*0.5 + G_exam*0.3 + G_final*0.2

GPA_overall = avg(subject_gpa for each subject)  # yoki kredit vaznlari bilan
```

---

## Minimal DB indekslar

* `attendance(student_id, date)`
* `grade(student_id, subject_id, term)`
* `scheduleentry(class_id, weekday, start_time)`
* `invoice(student_id, month)`
* `payment(invoice_id, paid_at)`

---

## UI (UZbekcha atamalar)

* **Dars jadvali** – Timetable
* **Davomat** – Attendance
* **Baholar** – Grades (Kundalik/Oraliq/Yakuniy)
* **O‘rtacha ball (GPA)**
* **Bayram/Ta’til** – Holiday
* **Bo‘sh vaqt** – Teacher free time
* **Oylik to‘lov** – Monthly tuition
* **Qarzdorlar** – Overdue
* **Reyting** – Ranking

---

## Keyingi qadamlar (taklif)

1. Mavjud kod skeletini shu tuzilma bo‘yicha tartiblang (apps: accounts, academics, billing, calendar).
2. Custom User (phone login) + JWT (DRF SimpleJWT) ni yoqing.
3. Model va migratsiyalarni yarating (yuqoridagilarga asoslanib).
4. Admin panel: Class/Subject/Teacher/Student CRUD.
5. Teacher uchun: Attendance va Grades endpointlari + UI.
6. Billing: Invoice generate + Payment qabul qilish + qarzdorlar ro‘yxati.
7. GPA & Reyting sahifalari.
8. PDF/Excel eksportlar.

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade Entry</title>
  <meta name="color-scheme" content="light">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="same-origin">

  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self';
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src https://fonts.gstatic.com;
                 img-src 'self' data:;
                 connect-src 'self';
                 frame-ancestors 'self';
                 base-uri 'self';
                 form-action 'self';
                 upgrade-insecure-requests">

  <link rel="stylesheet" href="{% static 'css/jadval-style.css' %}">

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { --brand:#4f46e5; --bg:#fff; --muted:#f7f7f7; --bd:#ddd; --bd2:#eee; --ok:#0a7a33; --err:#c01a1a; }
    body { font-family: 'Poppins', system-ui, -apple-system, Arial, sans-serif; margin:0; }
    .card { background:var(--bg); padding:16px; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,.1); }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:end; }
    label { font-weight:600; display:block; margin-bottom:4px; }
    select, input[type="date"], input[type="text"], input[type="number"] {
      padding:8px 10px; border:1px solid var(--bd); border-radius:8px; min-width:160px; background:#fff;
    }
    .btn { padding:10px 14px; border:1px solid var(--bd); border-radius:8px; background:#f7f7f7; cursor:pointer; }
    .btn.primary { background:var(--brand); color:#fff; border-color:var(--brand); }
    .btn.ghost { background:#fff; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .table { width:100%; border-collapse:collapse; margin-top:12px; }
    .table th, .table td { border:1px solid var(--bd2); padding:8px; }
    .table th { background:var(--muted); text-align:left; }
    .ok { color:var(--ok); margin-top:8px; }
    .err { color:var(--err); white-space:pre-wrap; margin-top:8px; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef; color:#2b2a8f; font-size:12px; }
    .hidden { display:none !important; }
    .bad { border-color: var(--err) !important; background: #fff6f6 !important; }
    .loading { display:flex; align-items:center; gap:8px; font-size:14px; color:#555; }
    .spinner {
      width:16px; height:16px; border:2px solid #ccc; border-top-color:var(--brand); border-radius:50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .menu a.active { background:#eef2ff; border-radius:8px; }
    .container { display:flex; min-height:100vh; }
    .sidebar { width:260px; background:#fff; border-right:1px solid var(--bd2); padding:16px; }
    .content { flex:1; padding:20px; }
    .logo-img { max-width:160px; height:auto; }
    .menu { display:flex; flex-direction:column; gap:8px; margin-top:12px; }
    .menu a { display:flex; align-items:center; gap:8px; padding:8px; text-decoration:none; color:#111; }
    .page-title { margin-top:0; }
    .skip-link { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
    .skip-link:focus { position:static; width:auto; height:auto; padding:8px; background:#eef2ff; border-radius:8px; }
  </style>
</head>
<body data-api-base="{{ API_BASE|default:'/api' }}">
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <noscript>
    <div class="card" style="margin:12px;color:#b91c1c;">
      JavaScript is disabled. JavaScript must be enabled for the page to work fully.
    </div>
  </noscript>

  <div class="container" data-page="grades-entry" data-allow-daily="{% if allow_daily %}true{% else %}false{% endif %}">
    <aside class="sidebar">
      <div class="logo">
        <img src="{% static 'img/Logo.png' %}" alt="School Logo" class="logo-img" loading="lazy" decoding="async" draggable="false">
      </div>
      <h3 class="sidebar-title">School Teacher</h3>
      <nav class="menu" aria-label="Main menu">
        <a href="/teachers/"><img src="{% static 'icons/Asosiy-white.png' %}" alt="" loading="lazy" decoding="async" draggable="false"> Home</a>
        <a href="/classes/"><img src="{% static 'icons/O‘quvchi.png' %}" alt="" loading="lazy" decoding="async" draggable="false"> Classes</a>
        <a href="/schedule/view/teacher/"><img src="{% static 'icons/O‘qituvchi.png' %}" alt="" loading="lazy" decoding="async" draggable="false"> Schedule</a>
        <a class="active" aria-current="page" href="/grades/entry/"><img src="{% static 'icons/Jadval.png' %}" alt="" loading="lazy" decoding="async" draggable="false"> Grade Entry</a>
      </nav>
    </aside>

    <main id="main-content" class="content" tabindex="-1">
      <h2 class="page-title">Grade Entry</h2>

      <div id="msg" class="hidden" role="status" aria-live="polite"></div>

      <div id="loading" class="loading hidden" role="status" aria-live="polite">
        <span class="spinner" aria-hidden="true"></span><span>Loading…</span>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div class="row" role="group" aria-label="Filters">
          <div>
            <label for="classSel">Class</label>
            <select id="classSel" aria-required="true"></select>
          </div>
          <div>
            <label for="subjectSel">Subject</label>
            <select id="subjectSel" aria-required="true">
              <option value="">— select —</option>
            </select>
          </div>
          <div>
            <label for="typeSel">Type</label>
            <select id="typeSel">
              <option value="exam">Exam</option>
              <option value="final">Final</option>
            </select>
          </div>
          <div>
            <label for="dateInp">Date</label>
            <input type="date" id="dateInp" inputmode="numeric" aria-required="true">
          </div>
          <div>
            <label for="termInp">Semester / Term</label>
            <input type="text" id="termInp" placeholder="e.g. 2025-1" autocomplete="off" spellcheck="false">
          </div>
          <button id="btnLoad" class="btn" type="button">Load Students</button>
          <span id="whoBadge" class="badge" aria-label="User role">Role: —</span>
        </div>
      </div>

      <div class="card" aria-live="off">
        <div class="row" style="justify-content:space-between; margin-bottom:10px;">
          <div style="display:flex; gap:8px;">
            <button id="btnFill3" class="btn ghost" type="button">Set All 3</button>
            <button id="btnFill4" class="btn ghost" type="button">Set All 4</button>
            <button id="btnFill5" class="btn ghost" type="button">Set All 5</button>
          </div>
          <div style="display:flex; gap:8px;">
            <button id="btnClear" class="btn ghost" type="button">Clear</button>
            <button id="btnSave" class="btn primary" type="button">Save</button>
          </div>
        </div>

        <table class="table" id="tbl">
          <thead>
            <tr>
              <th scope="col" style="width:60px;">№</th>
              <th scope="col">Last Name & First Name</th>
              <th scope="col" style="width:120px;">Grade (2..5)</th>
              <th scope="col">Comment</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>
  </div>

  <script defer src="{% static 'js/grades-entry.js' %}"></script>
</body>
</html>

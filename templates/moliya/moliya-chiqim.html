{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>School Finance — Expenses</title>
  <link rel="stylesheet" href="{% static 'css/moliya-chiqim-style.css' %}">
  <style>
    .card{background:#fff;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,.08);padding:14px 16px;margin-bottom:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
    label{font-weight:600;display:block;margin-bottom:4px}
    input[type="date"],input[type="number"],input[type="text"],select{border:1px solid #ddd;border-radius:8px;padding:8px 10px;min-width:160px}
    .btn{padding:10px 14px;border:1px solid #ddd;border-radius:8px;background:#f7f7f7;cursor:pointer}
    .btn.primary{background:#4f46e5;border-color:#4f46e5;color:#fff}
    .btn.ghost{background:#fff}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #eee;padding:8px}
    .table th{background:#f7f7f7;text-align:left}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#eef;color:#2b2a8f}
    .tag.salary{background:#e7f0ff;color:#173e91}
    .tag.manual{background:#fff1f1;color:#981b1b}
    .muted{color:#6b7280}
    .right{margin-left:auto}
    .totals{display:flex;gap:12px;align-items:center}
    .totals b{font-size:16px}
    dialog{width:520px;border:none;border-radius:12px;padding:0}
    dialog .dlg-body{padding:16px}
    dialog::backdrop{background:rgba(0,0,0,.4)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid .full{grid-column:1 / -1}
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <img src="{% static 'img/Logo.png' %}" alt="Logo" class="logo-img">
      </div>
      <h3 class="sidebar-title">School Finance</h3>
      <nav class="menu">
        <a href="{% url 'moliya-main' %}" ><img src="{% static 'icons/Asosiy-white.png' %}" alt=""> Home</a>
        <a href="{% url 'moliya-chiqim' %}" class="active"><img src="{% static 'icons/Chiqim.png' %}" alt=""> Expense</a>
        <a href="{% url 'moliya-oylik' %}"><img src="{% static 'icons/Jadval.png' %}" alt=""> Salaries</a>
        <a href="{% url 'moliya-tolovlar' %}"><img src="{% static 'icons/Moliya.png' %}" alt=""> Payments</a>
      </nav>
    </aside>

    <!-- Content -->
    <main class="content">
      <div class="topbar">
        <input type="text" id="q" placeholder="Search (note, type, method)">
        <div class="icons">
          <a href="#"><img src="{% static 'icons/Xabarlar.png' %}" alt="Bell"></a>
          <a href="#"><img src="{% static 'icons/Profil.png' %}" alt="Profile"></a>
        </div>
      </div>

      <h2 class="page-title">Expense List</h2>

      <!-- Filters -->
      <div class="card">
        <div class="row">
          <div>
            <label>From</label>
            <input type="date" id="fromDate">
          </div>
          <div>
            <label>To</label>
            <input type="date" id="toDate">
          </div>
          <div>
            <label>Include Salaries</label>
            <select id="incSalary">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>
          <button id="btnFilter" class="btn">Load</button>
          <button id="btnThisMonth" class="btn ghost">This month</button>
          <button id="btnReset" class="btn ghost">Clear</button>
          <button id="btnNew" class="btn primary">New Expense +</button>
          <div class="right totals">
            <span class="muted">Total:</span>
            <b id="sumBox">—</b>
            <button id="btnExport" class="btn">CSV</button>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="card">
        <div class="muted" style="margin-bottom:8px;">Rows: <span id="rowsCount">0</span></div>
        <div class="table-container">
          <table id="tbl">
            <thead>
              <tr>
                <th>#</th>
                <th>Date</th>
                <th>Type</th>
                <th>Note</th>
                <th>Method</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody><!-- Filled via JS --></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- New Expense dialog -->
  <dialog id="expDlg">
    <div class="dlg-body">
      <h3>New Expense</h3>
      <div class="grid" style="margin-top:10px;">
        <div>
          <label>Date</label>
          <input type="date" id="expDate">
        </div>
        <div>
          <label>Amount (UZS)</label>
          <input type="number" id="expAmount" min="1000" step="1000" placeholder="100000">
        </div>
        <div>
          <label>Method</label>
          <select id="expMethod">
            <option value="cash">Cash</option>
            <option value="card">Card</option>
            <option value="transfer">Transfer</option>
          </select>
        </div>
        <div>
          <label>Category</label>
          <select id="expCategory">
            <option value="salary">Salary payment</option>
            <option value="food">Food</option>
            <option value="tools">Tools & equipment</option>
<!--            <option value="rent">Rent</option>-->
<!--            <option value="utilities">Utilities</option>-->
            <option value="transport">Transport</option>
<!--            <option value="marketing">Marketing</option>-->
            <option value="repair">Repair</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="full">
          <label>Note</label>
          <input type="text" id="expReason" placeholder="optional">
        </div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button id="btnSaveExp" class="btn primary">Save</button>
        <button id="btnCancelExp" class="btn right">Close</button>
      </div>
    </div>
  </dialog>

  <script>window.API_BASE = '/api/billing';</script>
  <script src="{% static 'js/moliya-chiqim.js' %}" defer></script>
</body>
</html>

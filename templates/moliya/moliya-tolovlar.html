{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance — Student Payments</title>
  <link rel="stylesheet" href="{% static 'css/moliya-style.css' %}">
  <style>
    .card{background:#fff;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,.08);padding:16px;margin-bottom:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
    label{font-weight:600;display:block;margin-bottom:4px}
    select,input{border:1px solid #ddd;border-radius:8px;padding:8px 10px}
    .btn{padding:10px 14px;border:1px solid #ddd;border-radius:8px;background:#f7f7f7;cursor:pointer}
    .btn.primary{background:#4f46e5;border-color:#4f46e5;color:#fff}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #eee;padding:8px}
    .table th{background:#f7f7f7;text-align:left}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
    .pill.unpaid{background:#ffeaea;color:#a10000}
    .pill.partial{background:#fff6e5;color:#ad6b00}
    .pill.paid{background:#e9ffef;color:#046b2f}
    .pill.prepaid{background:#e7f0ff;color:#173e91}
    .right{margin-left:auto}
    .hidden{display:none}
    dialog{width:420px;border:none;border-radius:12px;padding:0}
    dialog .dlg-body{padding:16px}
    dialog::backdrop{background:rgba(0,0,0,.4)}
    .mini-grid{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
    .hint{color:#666;font-size:12px}
    #planMultiSel{min-width:260px}
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo"><img src="{% static 'img/Logo.png' %}" alt="Logo" class="logo-img"></div>
      <h3 class="sidebar-title">School Finance</h3>
      <nav class="menu">
        <a href="{% url 'moliya-main' %}" ><img src="{% static 'icons/Asosiy-white.png' %}" alt=""> Home</a>
        <a href="{% url 'moliya-chiqim' %}"><img src="{% static 'icons/Chiqim.png' %}" alt=""> Expense</a>
        <a href="{% url 'moliya-oylik' %}"><img src="{% static 'icons/Jadval.png' %}" alt=""> Salaries</a>
        <a href="{% url 'moliya-tolovlar' %}" class="active"><img src="{% static 'icons/Moliya.png' %}" alt=""> Payments</a>
      </nav>
    </aside>

    <!-- Content -->
    <main class="content">
      <div class="topbar">
        <input type="text" id="qSearch" placeholder="First name / last name / class">
        <div class="icons">
          <a href="#"><img src="{% static 'icons/Xabarlar.png' %}" alt=""></a>
          <a href="#"><img src="{% static 'icons/Profil.png' %}" alt=""></a>
        </div>
      </div>

      <h2 class="page-title">Student Payments</h2>

      <!-- Filters -->
      <div class="card">
        <div class="row">
          <div>
            <label>Month</label>
            <input type="month" id="monthInp">
          </div>
          <div>
            <label>Class</label>
            <select id="classSel"><option value="">— all —</option></select>
          </div>
          <div>
            <label>Status</label>
            <select id="statusSel">
              <option value="">— all —</option>
              <option value="unpaid">Unpaid</option>
              <option value="partial">Partial</option>
              <option value="paid">Paid</option>
              <option value="__prepaid">Prepaid (advance)</option>
            </select>
          </div>
          <button id="btnLoad" class="btn">Load</button>
          <div class="right">
            <button id="btnGenerate" class="btn">Generate invoices for month</button>
          </div>
        </div>
      </div>

      <!-- Tuition plan bulk panel -->
      <div class="card">
        <h3>Monthly Fee (apply to all or selected classes)</h3>

        <!-- Apply to ALL -->
        <div class="row">
          <div>
            <label>Amount (UZS)</label>
            <input type="number" id="planAmountAll" min="0" step="1000" placeholder="e.g. 450000">
          </div>
          <button id="btnPlanApplyAll" class="btn primary">Apply to all classes</button>
        </div>

        <!-- Apply to SELECTED -->
        <div class="row">
          <div>
            <label>Selected classes</label>
            <select id="planMultiSel" multiple size="6"></select>
          </div>
          <button id="btnPlanApplySelected" class="btn">Apply to selected classes</button>
        </div>

        <div class="row">
          <div class="hint">* If a single class has a different price, you can change it individually later.</div>
        </div>
      </div>

      <!-- Table -->
      <div class="card">
        <table class="table" id="tbl">
          <thead>
            <tr>
              <th>Student</th>
              <th>Class</th>
              <th>Month</th>
              <th>Amount</th>
              <th>Paid</th>
              <th>Remaining</th>
              <th>Status</th>
              <th style="width:120px;">Action</th>
            </tr>
          </thead>
          <tbody><!-- JS fills --></tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Add Payment modal -->
  <dialog id="payDlg">
    <div class="dlg-body">
      <h3>Add Payment</h3>
      <div style="margin:8px 0 12px;color:#666"><span id="dlgWho">—</span></div>
      <div class="mini-grid">
        <label>Amount (UZS)</label><input type="number" id="payAmount" min="1" step="1000">
        <label>Method</label>
        <select id="payMethod">
          <option value="cash">Cash</option>
          <option value="card">Card</option>
          <option value="transfer">Transfer</option>
        </select>
        <label>Note</label><input type="text" id="payNote" placeholder="optional">
      </div>
      <div class="row" style="margin-top:12px;">
        <button id="btnPaySave" class="btn primary">Save</button>
        <button id="btnPayCancel" class="btn right">Cancel</button>
      </div>
    </div>
  </dialog>

  <script>window.API_BASE = '/api/billing';</script>
  <script src="{% static 'js/moliya-tolovlar.js' %}" defer></script>
</body>
</html>
